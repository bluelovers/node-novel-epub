{"version":3,"file":"novel-epub.js","sourceRoot":"","sources":["novel-epub.ts"],"names":[],"mappings":"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","sourcesContent":["#!/usr/bin/env node\n\n/**\n * Created by user on 2018/2/18/018.\n */\n\nimport yargs = require('yargs');\nimport path = require('path');\nimport Promise = require('bluebird');\nimport novelEpub from '../index';\nimport updateNotifier = require('update-notifier');\nimport PACKAGE_JSON = require('../package.json');\nimport { Console } from 'debug-color2';\nimport { console } from '../lib/log';\n\nconst CWD = process.cwd();\n\nupdateNotifier({\n\tpkg: PACKAGE_JSON,\n}).notify();\n\nlet cli = yargs\n\t.default({\n\t\t//input: process.cwd(),\n\t})\n\t.option('input', {\n\t\talias: ['i'],\n\t\t//demandOption: true,\n\t\trequiresArg: true,\n\t\tnormalize: true,\n\t\ttype: 'string',\n\t\tdesc: '小說資料夾路徑 source novel txt folder path',\n\t\t/*\n\t\tdefault: function ()\n\t\t{\n\t\t\t//return process.cwd();\n\t\t},\n\t\t*/\n\t})\n\t.option('output', {\n\t\talias: ['o'],\n\t\t//demandOption: true,\n\t\trequiresArg: true,\n\t\tnormalize: true,\n\t\ttype: 'string',\n\t\tdesc: 'epub 輸出路徑 output path',\n\t\tdefault: function ()\n\t\t{\n\t\t\treturn CWD;\n\t\t},\n\t})\n\t.option('tpl', {\n\t\talias: ['t'],\n\t\trequiresArg: true,\n\t\ttype: 'string',\n\t\tdesc: 'epub 模板 epub tpl',\n\t})\n\t.option('filename', {\n\t\talias: ['f'],\n\t\trequiresArg: true,\n\t\ttype: 'string',\n\t\tdesc: 'epub 檔名 filename',\n\t})\n\t.option('useTitle', {\n\t\trequiresArg: true,\n\t\tdefault: true,\n\t})\n\t.option('filenameLocal', {\n\t\trequiresArg: true,\n\t\tdesc: 'try auto choose filename',\n\t\tdefault: true,\n\t})\n\t.option('date', {\n\t\tboolean: true,\n\t\talias: ['d'],\n\t\tdesc: 'epub 檔名後面追加日期 add current date end of filename',\n\t})\n\t.option('lang', {\n\t\talias: ['l'],\n\t\ttype: 'string',\n\t\tdesc: 'epub 語言 epub lang',\n\t})\n\t.option('vertical', {\n\t\ttype: 'boolean',\n\t\tdesc: `是否輸出直排模式`,\n\t})\n\t.option('downloadRemoteFile', {\n\t\ttype: 'boolean',\n\t\tdesc: `是否將網路資源下載到 epub 內`,\n\t})\n\t.option('iconv', {\n\t\ttype: 'string',\n\t\trequiresArg: true,\n\t\tdesc: `是否在打包時同時進行簡繁轉換 cn 轉為簡體, tw 轉為繁體`,\n\t})\n\t.showHelpOnFail(true)\n\t// @ts-ignore\n\t.command('$0', '', function (yargs)\n\t{\n\t\tlet inputPath = yargs.argv.input || yargs.argv._[0] || CWD;\n\t\tlet outputPath = yargs.argv.output as any as string;\n\n\t\tif (!path.isAbsolute(inputPath))\n\t\t{\n\t\t\tinputPath = path.join(CWD, inputPath);\n\t\t}\n\n\t\tif (!path.isAbsolute(outputPath))\n\t\t{\n\t\t\toutputPath = path.join(CWD, outputPath);\n\t\t}\n\n\t\tconsole.grey(`currentPath:\\n  `, inputPath);\n\t\tconsole.grey(`inputPath:\\n  `, inputPath);\n\t\tconsole.grey(`outputPath:\\n  `, outputPath);\n\n\t\tif (inputPath.indexOf(__dirname) == 0 || outputPath.indexOf(__dirname) == 0)\n\t\t{\n\t\t\tconsole.error(`[FAIL] path not allow`);\n\n\t\t\tyargs.showHelp();\n\n\t\t\tprocess.exit(1);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.log(`\\n`);\n\n\t\t//console.log(666, yargs.argv);\n\n\t\treturn novelEpub({\n\t\t\tinputPath,\n\t\t\toutputPath,\n\t\t\tfilename: yargs.argv.filename || null,\n\t\t\tuseTitle: yargs.argv.useTitle,\n\t\t\tfilenameLocal: yargs.argv.filenameLocal,\n\t\t\tepubLanguage: yargs.argv.lang,\n\t\t\tepubTemplate: yargs.argv.tpl,\n\t\t\tpadEndDate: yargs.argv.date,\n\t\t\tvertical: yargs.argv.vertical,\n\t\t\tdownloadRemoteFile: yargs.argv.downloadRemoteFile,\n\t\t\ticonv: yargs.argv.iconv,\n\t\t});\n\n\t\t//yargs.showHelp('log');\n\t})\n\t.version()\n\t//.help()\n\t.argv\n;\n"]}